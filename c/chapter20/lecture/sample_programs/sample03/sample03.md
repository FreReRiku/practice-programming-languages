# sample03.md

## ヘッダーファイルの重複防ぎ

ここまでは、extern宣言を使用して重複して定義されることを回避してきましたが、
実は、ヘッダーファイルの重複インクルードそれ以外を防ぐ方法もあります。
それには、#ifndef~#endif疑似命令を使用します。

#ifndef~#endif疑似命令を使用します。

#ifndef~#endif疑似命令は、ある記号が定義されていなかった場合だけ、
その間に挟まれたプログラムをコンパイルするという記号です。
この性質を利用して、次のようなヘッダーファイルを作成できます。

```h
/* sum.h */

#ifndef _INCLUDE_SUM_
#define _INCLUDE_SUM_

int sum(int min, int max);

#endif

```

このヘッダーファイルでは、最初に＿INCLUDE＿SUM＿(markdown上の仕様により、アンダーバーを全角にしています。)が
定義されているか調べて、
定義されていなかった場合だけ、その後のプログラムをコンパイルします。

ここでは、後にコンパイルされるプログラムの中で#define疑似命令を使って、
記号＿INCLUDE＿SUM＿を定義しているので、このヘッダーファイルが2回目に呼び出された場合、
記号＿INCLUDE＿SUM＿が定義されていることになり、コンパイルは行われません。

このようにすれば、同じ宣言を何度も行うことがなくなります。
2回目以降はコンパイルされないのでは、1つしか使えなくなるようにも思えますが、
最終的にはすべてのソースファイルは結合されるので、1回コンパイルすれば十分です。

なお、一般には、extern宣言も組み合わせて、次のようにします。
更に、以下のようなコメントをいれると、より良いヘッダーファイルが完成します。
この書き方であれば、トラブルが起こりにくいため、常にこの書き方にすることをおすすめします。

```h
/* sum.h */

#ifndef _INCLUDE_SUM_
#define _INCLUDE_SUM_

/* min~max間の合計値を計算する関数
 * int min: 最小値
 * int max: 最大値
 * 戻り値 : 合計値
 */
extern int sum(int min, int max);

#endif

```

### 説明コメントの場所

このように、関数を説明するコメントをつけるプログラムはよく見かけます。
こうすれば、他人が見たときや、時間がたってから自分が見たときでも、内容が素早く把握できて便利です。

ただ、筆者は、このようなコメントはヘッダーファイルの中に書くべきで、
ソースファイルの中に書くべきでないと思います。
ヘッダーファイルはその関数を利用するすべての人が読みますがｌ
ソースファイルの方は誰もが読むとは限らないためです。

### 自動でできそうな気もするが...

ヘッダーファイルは書き方が決まりきっているため、
ソースファイルから自動的に生成することができるような気もします。
実際、他の多くの言語では、自動でやってくれるため、ヘッダーファイル葉不要です。

しかし、ヘッダーファイルにはソースファイルの設計書という意味もあります。
先にヘッダーファイルを作り、それに合わせてプログラムを作っていくわけです。
また、ソースファイルには、ヘッダーファイルに書く必要のない、
そのソースファイル固有の関数や変数が使われていることもよくあるため、
自動生成で不要な宣言までヘッダーにしてしまうと、ある種のムダが出てしまいます。

C言語はプログラマーが意識しなければならないことが多いかわりに、意識して行えば、ムダを大きく減らせるようになっています。

